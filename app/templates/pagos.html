{% extends "base.html" %}
{% block content %}

<h2>Registrar Pago</h2>

{% if ok %}
  <div class="alert alert-success">✅ Listo.</div>
{% endif %}
{% if error %}
  <div class="alert alert-danger">❌ Ocurrió un error: {{ error }}</div>
{% endif %}

<form method="post" action="/pagos/guardar" class="card p-3 mb-4">

  <div class="mb-3">
    <label>Cliente</label>
    <select name="cedula" class="form-control" required>
      <option value="">Seleccione cliente</option>
      {% for c in clientes %}
        <option value="{{ c['cedula'] }}">
          {{ c['nombre'] }} - {{ c['cedula'] }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label>Valor</label>
    <input type="number" name="valor" class="form-control" required>
  </div>

  <div class="mb-3">
    <label>Fecha</label>
    <input type="date" name="fecha" class="form-control" required>
  </div>

  <button class="btn btn-success w-100">Guardar Pago</button>

</form>


<h3>Últimos pagos</h3>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Cliente</th>
      <th>Cédula</th>
      <th>Fecha</th>
      <th>Valor</th>
      <th>Tipo cobro</th>
      <th style="width:140px;">Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for p in pagos %}
    <tr>
      <td>{{ p.cliente }}</td>
      <td>{{ p.cedula }}</td>
      <td>{{ "" if p.fecha == "nan" else p.fecha }}</td>
      <td>{{ p.valor }}</td>
      <td>{{ p.tipo_cobro }}</td>
      <td>
        <form method="post" action="/pagos/eliminar" onsubmit="return confirm('¿Eliminar este pago?');" style="display:inline;">
          <input type="hidden" name="row_id" value="{{ p.row_id }}">
          <button class="btn btn-sm btn-danger">Eliminar</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
